{"ast":null,"code":"import _slicedToArray from\"D:/login_and_register - Copy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Link}from\"react-router-dom\";import{useEffect}from\"react\";import{useHistory}from\"react-router\";import axios from\"axios\";import Modal from\"react-modal\";import{Loader}from\"semantic-ui-react\";import\"./Promotiondetails.css\";import{AnimatePresence,motion}from\"framer-motion\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var customStyles={content:{top:\"50%\",left:\"50%\",right:\"auto\",bottom:\"auto\",marginRight:\"-50%\",transform:\"translate(-50%, -50%)\"}};function Promotiondetails(shop){var subtitle;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),modalIsOpenModal=_React$useState2[0],setIsOpenModal=_React$useState2[1];function openModal(){setIsOpenModal(true);}function afterOpenModal(){// references are now sync'd and can be accessed.\nsubtitle.style.color=\"#000\";}function closeModal(){setIsOpenModal(false);}//-----------------------------------------------------\nvar history=useHistory();var setshop=shop;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),phone=_useState2[0],setPhone=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),shopname=_useState4[0],setshopname=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),point=_useState6[0],setPoint=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),amount=_useState8[0],setamount=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),product_name=_useState10[0],setProductName=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),promotionlist=_useState12[0],setPromotionList=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),promotionpointlist=_useState14[0],setPromotionPointList=_useState14[1];var _useState15=useState(true),_useState16=_slicedToArray(_useState15,2),active=_useState16[0],setactive=_useState16[1];//loader\n//-----------------------------------------------------\nvar showpromotion=function showpromotion(shopname){axios.post(\"/getpromotionpoint\",{shop_name:shopname}).then(function(response){if(response){setPromotionPointList(response.data);}});axios.post(\"/selectshop\",{shop_name:shopname}).then(function(response){setPromotionList(response.data);});};var selectpromotion=function selectpromotion(id){axios.post(\"/selectpromotion\",{id:id}).then(function(response){if(response){setProductName(response.data[0].product_name);setamount(response.data[0].amount);setshopname(response.data[0].shop_name);openModal();}});};var submitpromotion=function submitpromotion(){if(amount>point){alert(\"คะแนนไม่เพียงพอ\");}else{axios.post(\"/promotion/exchange\",{shopname:shopname,amount:amount,phone:phone}).then(function(response){if(response.data){alert(response.data.status);history.go();}});}};/* ********************************** */var pageTransition={in:{opacity:1,x:0},out:{opacity:0,x:100}};/* ********************************** */useEffect(function(){var timer=setTimeout(function(){setactive(false);axios.get(\"/login\").then(function(response){if(response.data.loggedIn===true){if(response.data.user[0].role===\"member\"){axios.get(\"/member\").then(function(response){if(response){setPoint(response.data.user[0].point);}});}else if(response.data.user[0].role===\"shop\"){axios.get(\"/shop\").then(function(response){if(response){setPoint(response.data.user[0].point);}});}setPhone(response.data.user[0].phone);showpromotion(setshop.match.params.shopname);}else if(response.data.loggedIn===false||!response.data.user[0].role){return history.push(\"/login\");}});},1000);return function(){return clearTimeout(timer);};},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"link\",{href:\"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\",rel:\"stylesheet\"}),/*#__PURE__*/_jsx(\"div\",{className:\"promotiondetails\",children:/*#__PURE__*/_jsx(Modal,{isOpen:modalIsOpenModal,onAfterOpen:afterOpenModal,onRequestClose:closeModal,style:customStyles,contentLabel:\"Example Modal\",children:/*#__PURE__*/_jsx(motion.div,{initial:\"out\",animate:\"in\",exit:\"out\",variants:pageTransition,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modalpromotiondetails\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"h2h2h2promotiondetails\",ref:function ref(_subtitle){return subtitle=_subtitle;},children:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 : \",product_name]})}),/*#__PURE__*/_jsx(\"h3\",{className:\"h3h3h3promotiondetails\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19 : \",amount]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"buttoncalculate-modal1\",onClick:submitpromotion,children:\"\\u0E43\\u0E0A\\u0E49\\u0E2A\\u0E34\\u0E17\\u0E18\\u0E34\"}),/*#__PURE__*/_jsx(\"button\",{className:\"buttoncalculate-modal2\",onClick:closeModal,children:\"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"})]})]})})})}),/*#__PURE__*/_jsxs(\"nav\",{className:\"navbar navbar-light bg-light justify-content-between\",children:[/*#__PURE__*/_jsx(Link,{className:\"buttonblack\",onClick:function onClick(){history.goBack();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-angle-left\",children:/*#__PURE__*/_jsx(\"a\",{className:\"bl\",children:\"\\u0E22\\u0E49\\u0E2D\\u0E19\\u0E01\\u0E25\\u0E31\\u0E1A\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"div-img-logo2\",children:/*#__PURE__*/_jsx(\"img\",{className:\"img-logoo\",src:\"/images/logo.png\"})})]}),/*#__PURE__*/_jsx(motion.div,{initial:\"out\",animate:\"in\",exit:\"out\",variants:pageTransition,children:/*#__PURE__*/_jsxs(\"div\",{className:\"top-promotion\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"divh1promotiondetails1\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"h1promotiondetails1\",children:\"\\u0E42\\u0E1B\\u0E23\\u0E42\\u0E21\\u0E0A\\u0E31\\u0E48\\u0E19\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container-promotion\",children:[/*#__PURE__*/_jsx(Loader,{active:active}),promotionpointlist.map(function(val){return/*#__PURE__*/_jsxs(\"div\",{className:\"shopbox-promotin\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"shopbox-img\",children:/*#__PURE__*/_jsx(\"img\",{className:\"img-fluid-shopbox\",src:val.picture,style:{height:\"100px\"},alt:\"trainer-img\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"boxpromotion\",children:[/*#__PURE__*/_jsx(\"p\",{children:val.product_name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0E44\\u0E14\\u0E49\\u0E23\\u0E31\\u0E1A : \",val.amount_point,\" \\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\"]})]})]});})]}),/*#__PURE__*/_jsx(\"div\",{className:\"divh1promotiondetails2\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"h1promotiondetails2\",children:\"\\u0E42\\u0E1B\\u0E23\\u0E42\\u0E21\\u0E0A\\u0E31\\u0E48\\u0E19\\u0E41\\u0E25\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container-promotion\",children:[/*#__PURE__*/_jsx(Loader,{active:active}),promotionlist.map(function(val){return/*#__PURE__*/_jsxs(\"div\",{className:\"shopbox-promotin\",onClick:function onClick(){selectpromotion(val.id);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"shopbox-img\",children:/*#__PURE__*/_jsx(\"img\",{className:\"img-fluid-shopbox\",src:val.picture,style:{height:\"100px\"},alt:\"trainer-img\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"boxpromotion\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 : \",val.product_name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\\u0E17\\u0E35\\u0E48\\u0E43\\u0E0A\\u0E49 : \",val.amount]})]})]});})]})]})})]});}export default Promotiondetails;","map":{"version":3,"sources":["D:/login_and_register - Copy/client/src/components/Promotiondetails.js"],"names":["React","useState","Link","useEffect","useHistory","axios","Modal","Loader","AnimatePresence","motion","customStyles","content","top","left","right","bottom","marginRight","transform","Promotiondetails","shop","subtitle","modalIsOpenModal","setIsOpenModal","openModal","afterOpenModal","style","color","closeModal","history","setshop","phone","setPhone","shopname","setshopname","point","setPoint","amount","setamount","product_name","setProductName","promotionlist","setPromotionList","promotionpointlist","setPromotionPointList","active","setactive","showpromotion","post","shop_name","then","response","data","selectpromotion","id","submitpromotion","alert","status","go","pageTransition","in","opacity","x","out","timer","setTimeout","get","loggedIn","user","role","match","params","push","clearTimeout","_subtitle","goBack","map","val","picture","height","amount_point"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useEffect } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport axios from \"axios\";\r\nimport Modal from \"react-modal\";\r\nimport { Loader } from \"semantic-ui-react\";\r\nimport \"./Promotiondetails.css\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\n\r\nconst customStyles = {\r\n  content: {\r\n    top: \"50%\",\r\n    left: \"50%\",\r\n    right: \"auto\",\r\n    bottom: \"auto\",\r\n    marginRight: \"-50%\",\r\n    transform: \"translate(-50%, -50%)\",\r\n  },\r\n};\r\n\r\nfunction Promotiondetails(shop) {\r\n  let subtitle;\r\n  const [modalIsOpenModal, setIsOpenModal] = React.useState(false);\r\n\r\n  function openModal() {\r\n    setIsOpenModal(true);\r\n  }\r\n\r\n  function afterOpenModal() {\r\n    // references are now sync'd and can be accessed.\r\n    subtitle.style.color = \"#000\";\r\n  }\r\n\r\n  function closeModal() {\r\n    setIsOpenModal(false);\r\n  }\r\n  //-----------------------------------------------------\r\n  const history = useHistory();\r\n  const setshop = shop;\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [shopname, setshopname] = useState(\"\");\r\n  const [point, setPoint] = useState();\r\n\r\n  const [amount, setamount] = useState();\r\n  const [product_name, setProductName] = useState(\"\");\r\n  const [promotionlist, setPromotionList] = useState([]);\r\n  const [promotionpointlist, setPromotionPointList] = useState([]);\r\n\r\n  const [active, setactive] = useState(true); //loader\r\n  //-----------------------------------------------------\r\n\r\n  const showpromotion = (shopname) => {\r\n    axios\r\n      .post(\"/getpromotionpoint\", { shop_name: shopname })\r\n      .then((response) => {\r\n        if (response) {\r\n          setPromotionPointList(response.data);\r\n        }\r\n      });\r\n    axios\r\n      .post(\"/selectshop\", {\r\n        shop_name: shopname,\r\n      })\r\n      .then((response) => {\r\n        setPromotionList(response.data);\r\n      });\r\n  };\r\n\r\n  const selectpromotion = (id) => {\r\n    axios\r\n      .post(\"/selectpromotion\", {\r\n        id: id,\r\n      })\r\n      .then((response) => {\r\n        if (response) {\r\n          setProductName(response.data[0].product_name);\r\n          setamount(response.data[0].amount);\r\n          setshopname(response.data[0].shop_name);\r\n          openModal();\r\n        }\r\n      });\r\n  };\r\n\r\n  const submitpromotion = () => {\r\n    if (amount > point) {\r\n      alert(\"คะแนนไม่เพียงพอ\");\r\n    } else {\r\n      axios\r\n        .post(\"/promotion/exchange\", {\r\n          shopname: shopname,\r\n          amount: amount,\r\n          phone: phone,\r\n        })\r\n        .then((response) => {\r\n          if (response.data) {\r\n            alert(response.data.status);\r\n            history.go();\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  /* ********************************** */\r\n\r\n  const pageTransition = {\r\n\r\n    in: {\r\n      opacity: 1,\r\n      x: 0,\r\n\r\n    },\r\n    out: {\r\n      opacity: 0,\r\n      x: 100,\r\n\r\n    }\r\n  };\r\n\r\n\r\n  /* ********************************** */\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setactive(false);\r\n      axios.get(\"/login\").then((response) => {\r\n        if (response.data.loggedIn === true) {\r\n          if (response.data.user[0].role === \"member\") {\r\n            axios.get(\"/member\").then((response) => {\r\n              if (response) {\r\n                setPoint(response.data.user[0].point);\r\n              }\r\n            });\r\n          } else if (response.data.user[0].role === \"shop\") {\r\n            axios.get(\"/shop\").then((response) => {\r\n              if (response) {\r\n                setPoint(response.data.user[0].point);\r\n              }\r\n            });\r\n          }\r\n          setPhone(response.data.user[0].phone);\r\n          showpromotion(setshop.match.params.shopname);\r\n        } else if (\r\n          response.data.loggedIn === false ||\r\n          !response.data.user[0].role\r\n        ) {\r\n          return history.push(\"/login\");\r\n        }\r\n      });\r\n    }, 1000);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <link\r\n        href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\"\r\n        rel=\"stylesheet\"\r\n      />\r\n\r\n      <div className=\"promotiondetails\">\r\n        <Modal\r\n          isOpen={modalIsOpenModal}\r\n          onAfterOpen={afterOpenModal}\r\n          onRequestClose={closeModal}\r\n          style={customStyles}\r\n          contentLabel=\"Example Modal\"\r\n        >\r\n           <motion.div initial=\"out\" animate=\"in\" exit=\"out\" variants={pageTransition}>\r\n          <div className=\"modalpromotiondetails\">\r\n            <h2\r\n              className=\"h2h2h2promotiondetails\"\r\n              ref={(_subtitle) => (subtitle = _subtitle)}\r\n            >\r\n              <p>ชื่อสินค้า : {product_name}</p>\r\n            </h2>\r\n            <h3 className=\"h3h3h3promotiondetails\">\r\n              <p>จำนวนคะแนน : {amount}</p>\r\n            </h3>\r\n            <div>\r\n              <button\r\n                className=\"buttoncalculate-modal1\"\r\n                onClick={submitpromotion}\r\n              >\r\n                ใช้สิทธิ\r\n              </button>\r\n              <button className=\"buttoncalculate-modal2\" onClick={closeModal}>\r\n                ยกเลิก\r\n              </button>\r\n            </div>\r\n          </div>\r\n          </motion.div>\r\n        </Modal>\r\n      </div>\r\n\r\n      <nav className=\"navbar navbar-light bg-light justify-content-between\">\r\n        <Link\r\n          className=\"buttonblack\"\r\n          onClick={() => {\r\n            history.goBack();\r\n          }}\r\n        >\r\n          <i className=\"fas fa-angle-left\">\r\n            <a className=\"bl\">ย้อนกลับ</a>\r\n          </i>\r\n        </Link>\r\n        <div className=\"div-img-logo2\">\r\n          <img className=\"img-logoo\" src=\"/images/logo.png\" />\r\n        </div>\r\n      </nav>\r\n\r\n      <motion.div initial=\"out\" animate=\"in\" exit=\"out\" variants={pageTransition}>\r\n      <div className=\"top-promotion\">\r\n        <div className=\"divh1promotiondetails1\">\r\n          <h1 className=\"h1promotiondetails1\">โปรโมชั่นคะแนน</h1></div>\r\n        <div className=\"container-promotion\">\r\n\r\n          <Loader active={active} />\r\n          {promotionpointlist.map((val) => {\r\n            return (\r\n              <div className=\"shopbox-promotin\">\r\n                {/*shopbox-img แต่งไว้ที่ promotionshop*/}\r\n                <div className=\"shopbox-img\">\r\n                  <img\r\n                    className=\"img-fluid-shopbox\"\r\n                    src={val.picture}\r\n                    style={{height : \"100px\"}}\r\n                    alt=\"trainer-img\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"boxpromotion\">\r\n                  <p>{val.product_name}</p>\r\n                  <p>ได้รับ : {val.amount_point} คะแนน</p>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n        <div className=\"divh1promotiondetails2\">\r\n          <h1 className=\"h1promotiondetails2\">โปรโมชั่นแลกสินค้า</h1></div>\r\n        <div className=\"container-promotion\">\r\n\r\n          <Loader active={active} />\r\n          {promotionlist.map((val) => {\r\n            return (\r\n              <div\r\n                className=\"shopbox-promotin\"\r\n                onClick={() => {\r\n                  selectpromotion(val.id);\r\n                }}\r\n              >\r\n                {/*shopbox-img แต่งไว้ที่ promotionshop*/}\r\n                <div className=\"shopbox-img\">\r\n                  <img\r\n                    className=\"img-fluid-shopbox\"\r\n                    src={val.picture}\r\n                    style={{height : \"100px\"}}\r\n                    alt=\"trainer-img\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"boxpromotion\">\r\n                  <p>ชื่อสินค้า : {val.product_name}</p>\r\n                  <p>คะแนนที่ใช้ : {val.amount}</p>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\nexport default Promotiondetails;\r\n"]},"metadata":{},"sourceType":"module"}