{"ast":null,"code":"import _toConsumableArray from\"D:/login_and_register - Copy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/login_and_register - Copy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Link,useHistory}from\"react-router-dom\";import{useEffect}from\"react\";import axios from\"axios\";import Modal from\"react-modal\";import\"./Calculatepointshop.css\";import{AnimatePresence,motion}from\"framer-motion\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var customStyles={content:{width:\"100%\",height:\"50%\",top:\"50%\",left:\"50%\",right:\"auto\",bottom:\"auto\",marginRight:\"-50%\",transform:\"translate(-50%, -50%)\"}};function Calculatepointshop(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),modalIsOpen=_React$useState2[0],setIsOpen=_React$useState2[1];function openModal(){setIsOpen(true);}function afterOpenModal(){// references are now sync'd and can be accessed.\n}function closeModal(){setIsOpen(false);}//-----------------------------------------------------\nvar history=useHistory();//-----------------------------------------------------\nvar _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),product_code=_useState2[0],setproduct_code=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),productlist=_useState4[0],setProductlist=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),promotionlist=_useState6[0],setPromotionlist=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),total_price=_useState8[0],setTotal_Price=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),id=_useState10[0],setId=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),shoppoint=_useState12[0],setShopPoint=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),phone=_useState14[0],setPhone=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),destPhone=_useState16[0],setdestPhone=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),total_point=_useState18[0],setTotal_Point=_useState18[1];var refresh=function refresh(){axios.get(\"/shop\");window.location.reload();};var entercode=function entercode(){var a;if(!product_code){}else{axios.post(\"/enterproductcode\",{product_code:product_code}).then(function(response){if(response.data.productlist){for(a=0;a<\"\".concat(productlist.length);a++){}setProductlist([].concat(_toConsumableArray(productlist),[{id:a,product_name:response.data.productlist[0].product_name,product_code:response.data.productlist[0].product_code,price:response.data.productlist[0].price}]));setTotal_Price(total_price+response.data.productlist[0].price);}else if(response.data.result2){for(a=0;a<\"\".concat(productlist.length);a++){}setProductlist([].concat(_toConsumableArray(productlist),[{id:a,product_name:response.data.result1[0].product_name,product_code:response.data.result1[0].product_code,price:response.data.result1[0].price}]));setPromotionlist([].concat(_toConsumableArray(promotionlist),[{id:a,product_name:response.data.result1[0].product_name,product_code:response.data.result1[0].product_code,price:response.data.result1[0].price,amount_point:response.data.result2.amount_point}]));setTotal_Price(total_price+response.data.result1[0].price);}});setproduct_code(\"\");}};var transferTocustomer=function transferTocustomer(){if(!destPhone){axios.post(\"/transaction/buying\",{list:productlist,destPhone:destPhone});alert(\"success\");history.go();}else{if(shoppoint<total_point){alert(\"คะแนนร้านค้าไม่เพียงพอ กรุณาเติมคะแนน\");}else{axios.post(\"/calculateprice\",{total_point:total_point,destPhone:destPhone}).then(function(response){if(response.data.calculate){axios.post(\"/transaction/buying\",{list:productlist,destPhone:destPhone});alert(response.data.calculate);axios.get(\"/shop\");history.push(\"/calculate-point-shop\");}else{alert(response.data.message);}});}}};var calculatepoint=function calculatepoint(){var promotionpoint=0;for(var i=0;i<\"\".concat(promotionlist.length);i++){promotionpoint+=promotionlist[i].amount_point-Math.floor(promotionlist[i].price/50);}setTotal_Point(Math.floor(total_price/50)+promotionpoint);if(productlist.length===0){}else{openModal();}};var deleteproduct=function deleteproduct(e){var id=e.target.getAttribute(\"name\");setProductlist(productlist.filter(function(productlist){return JSON.stringify(productlist.id)!==id;}));setPromotionlist(promotionlist.filter(function(promotionlist){return JSON.stringify(promotionlist.id)!==id;}));};var updateprice=function updateprice(price){setTotal_Price(total_price-price);};var gotoTopupPage=function gotoTopupPage(){history.push(\"/top-up-point-shop\");};/* ********************************** */var pageTransition={in:{opacity:1,x:0},out:{opacity:0,x:100}};/* ********************************** */useEffect(function(){axios.get(\"/login\").then(function(response){if(response.data.loggedIn===true){setId(response.data.user[0].id);setShopPoint(response.data.user[0].shoppoint);setPhone(response.data.user[0].phone);}if(response.data.loggedIn===false||response.data.user[0].role!==\"shop\"){return history.push(\"/login\");}});},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"calculatepointpage\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"calculate-modal\",children:/*#__PURE__*/_jsx(Modal,{isOpen:modalIsOpen,onAfterOpen:afterOpenModal,onRequestClose:closeModal,style:customStyles,contentLabel:\"Example Modal\",children:/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},children:/*#__PURE__*/_jsxs(\"div\",{className:\"divcalculate-modal\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"pcalculate-modal\",children:[\"\\u0E44\\u0E14\\u0E49\\u0E23\\u0E31\\u0E1A : \",total_point,\" \\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"buttoncalculate-modal1\",onClick:transferTocustomer,children:\"\\u0E22\\u0E37\\u0E19\\u0E22\\u0E31\\u0E19\"}),/*#__PURE__*/_jsx(\"button\",{className:\"buttoncalculate-modal2\",onClick:closeModal,children:\"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"})]})]})})})}),/*#__PURE__*/_jsx(\"link\",{rel:\"stylesheet\",type:\"text/css\",href:\"//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css\"}),/*#__PURE__*/_jsx(\"link\",{href:\"//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css\",rel:\"stylesheet\"}),/*#__PURE__*/_jsxs(\"nav\",{className:\"navbar navbar-light bg-light justify-content-between\",children:[/*#__PURE__*/_jsx(Link,{className:\"buttonblack\",to:\"/\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-angle-left\",children:/*#__PURE__*/_jsx(\"a\",{className:\"bl\",children:\"\\u0E22\\u0E49\\u0E2D\\u0E19\\u0E01\\u0E25\\u0E31\\u0E1A\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"div-img-logo2\",children:/*#__PURE__*/_jsx(\"img\",{className:\"img-logoo\",src:\"/images/logo.png\"})})]}),/*#__PURE__*/_jsxs(motion.div,{initial:\"out\",animate:\"in\",exit:\"out\",variants:pageTransition,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"calculate-point-shop\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:gotoTopupPage,className:\"buttontop-up\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus\"}),\"\\u0E40\\u0E15\\u0E34\\u0E21\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"calculate-con\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"h2promotion\",children:\"\\u0E04\\u0E33\\u0E19\\u0E27\\u0E13\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\"}),/*#__PURE__*/_jsxs(\"h1\",{className:\"h1promotion\",children:[\"\\u0E04\\u0E30\\u0E41\\u0E19\\u0E19\\u0E02\\u0E2D\\u0E07\\u0E23\\u0E49\\u0E32\\u0E19\\u0E04\\u0E49\\u0E32 : \",shoppoint,\" \",/*#__PURE__*/_jsx(\"i\",{onClick:refresh,className:\"fas fa-sync-alt\",style:{color:\"black\"}})]})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"from-calculatepointshop\",onSubmit:function onSubmit(e){e.preventDefault();entercode();},children:[/*#__PURE__*/_jsx(\"input\",{className:\"input-input1-calculatepointshopp\",type:\"tel\",placeholder:\"\\u0E40\\u0E1A\\u0E2D\\u0E23\\u0E4C\\u0E42\\u0E17\\u0E23\\u0E25\\u0E39\\u0E01\\u0E04\\u0E49\\u0E32\",onChange:function onChange(e){setdestPhone(e.target.value);}}),/*#__PURE__*/_jsx(\"input\",{className:\"input-input2-calculatepointshopp\",type:\"text\",placeholder:\"\\u0E23\\u0E2B\\u0E31\\u0E2A\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\",value:product_code,onChange:function onChange(e){setproduct_code(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{className:\"button-input-calculatepointshop\",type:\"submit\",children:\"\\u0E15\\u0E01\\u0E25\\u0E07\"})]})]}),/*#__PURE__*/_jsx(\"div\",{class:\"table-wrapper-scroll-y my-custom-scrollbar\",children:/*#__PURE__*/_jsxs(\"table\",{class:\"table table-bordered table-striped mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"th-table\",scope:\"col\",children:\"\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"}),/*#__PURE__*/_jsx(\"th\",{className:\"th-table\",scope:\"col\",children:\"\\u0E23\\u0E32\\u0E04\\u0E32\"}),/*#__PURE__*/_jsx(\"th\",{className:\"th-table\",scope:\"col\",children:\"\\u0E15\\u0E31\\u0E27\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\"})]})}),productlist.map(function(post){return/*#__PURE__*/_jsx(\"tbody\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"td-table\",children:/*#__PURE__*/_jsx(\"p\",{children:post.product_name})}),/*#__PURE__*/_jsx(\"td\",{className:\"td-table\",children:/*#__PURE__*/_jsx(\"p\",{price:post.price,children:post.price})}),/*#__PURE__*/_jsx(\"td\",{className:\"td-table\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"button-delete-item\",name:post.id,onClick:function onClick(e){deleteproduct(e);updateprice(post.price);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-times-circle\"}),\" \\u0E25\\u0E1A\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E19\\u0E35\\u0E49\",\" \",/*#__PURE__*/_jsx(\"i\",{className:\"far fa-times-circle\"})]})})]})});}),/*#__PURE__*/_jsx(\"tr\",{children:promotionlist.map(function(promotion){return/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\"},children:/*#__PURE__*/_jsxs(\"p\",{name:promotion.id,children:[\"\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E42\\u0E1B\\u0E23\\u0E42\\u0E21\\u0E0A\\u0E31\\u0E19 : \",promotion.product_name]})});})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"div-total-price\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"h3-total-price\",children:[\"\\u0E23\\u0E32\\u0E04\\u0E32\\u0E23\\u0E27\\u0E21 : \",total_price,\" \"]}),/*#__PURE__*/_jsx(\"button\",{className:\"button-total-price\",onClick:calculatepoint,children:\"\\u0E04\\u0E34\\u0E14\\u0E40\\u0E07\\u0E34\\u0E19\"})]})]})]});}export default Calculatepointshop;","map":{"version":3,"sources":["D:/login_and_register - Copy/client/src/components/Calculatepointshop.js"],"names":["React","useState","Link","useHistory","useEffect","axios","Modal","AnimatePresence","motion","customStyles","content","width","height","top","left","right","bottom","marginRight","transform","Calculatepointshop","modalIsOpen","setIsOpen","openModal","afterOpenModal","closeModal","history","product_code","setproduct_code","productlist","setProductlist","promotionlist","setPromotionlist","total_price","setTotal_Price","id","setId","shoppoint","setShopPoint","phone","setPhone","destPhone","setdestPhone","total_point","setTotal_Point","refresh","get","window","location","reload","entercode","a","post","then","response","data","length","product_name","price","result2","result1","amount_point","transferTocustomer","list","alert","go","calculate","push","message","calculatepoint","promotionpoint","i","Math","floor","deleteproduct","e","target","getAttribute","filter","JSON","stringify","updateprice","gotoTopupPage","pageTransition","in","opacity","x","out","loggedIn","user","role","y","color","preventDefault","value","map","promotion","display"],"mappings":"4TAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OAASC,IAAT,CAAeC,UAAf,KAAiC,kBAAjC,CACA,OAASC,SAAT,KAA0B,OAA1B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,aAAlB,CACA,MAAO,0BAAP,CACA,OAASC,eAAT,CAA0BC,MAA1B,KAAwC,eAAxC,C,wFAEA,GAAMC,CAAAA,YAAY,CAAG,CACnBC,OAAO,CAAE,CACPC,KAAK,CAAE,MADA,CAEPC,MAAM,CAAE,KAFD,CAGPC,GAAG,CAAE,KAHE,CAIPC,IAAI,CAAE,KAJC,CAKPC,KAAK,CAAE,MALA,CAMPC,MAAM,CAAE,MAND,CAOPC,WAAW,CAAE,MAPN,CAQPC,SAAS,CAAE,uBARJ,CADU,CAArB,CAaA,QAASC,CAAAA,kBAAT,EAA8B,CAC5B,oBAAiCnB,KAAK,CAACC,QAAN,CAAe,KAAf,CAAjC,oDAAOmB,WAAP,qBAAoBC,SAApB,qBAEA,QAASC,CAAAA,SAAT,EAAqB,CACnBD,SAAS,CAAC,IAAD,CAAT,CACD,CAED,QAASE,CAAAA,cAAT,EAA0B,CACxB;AACD,CAED,QAASC,CAAAA,UAAT,EAAsB,CACpBH,SAAS,CAAC,KAAD,CAAT,CACD,CAED;AACA,GAAMI,CAAAA,OAAO,CAAGtB,UAAU,EAA1B,CACA;AACA,cAAwCF,QAAQ,CAAC,EAAD,CAAhD,wCAAOyB,YAAP,eAAqBC,eAArB,eACA,eAAsC1B,QAAQ,CAAC,EAAD,CAA9C,yCAAO2B,WAAP,eAAoBC,cAApB,eACA,eAA0C5B,QAAQ,CAAC,EAAD,CAAlD,yCAAO6B,aAAP,eAAsBC,gBAAtB,eACA,eAAsC9B,QAAQ,CAAC,CAAD,CAA9C,yCAAO+B,WAAP,eAAoBC,cAApB,eACA,eAAoBhC,QAAQ,EAA5B,0CAAOiC,EAAP,gBAAWC,KAAX,gBACA,gBAAkClC,QAAQ,EAA1C,2CAAOmC,SAAP,gBAAkBC,YAAlB,gBACA,gBAA0BpC,QAAQ,CAAC,EAAD,CAAlC,2CAAOqC,KAAP,gBAAcC,QAAd,gBACA,gBAAkCtC,QAAQ,CAAC,EAAD,CAA1C,2CAAOuC,SAAP,gBAAkBC,YAAlB,gBACA,gBAAsCxC,QAAQ,CAAC,CAAD,CAA9C,2CAAOyC,WAAP,gBAAoBC,cAApB,gBAEA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpBvC,KAAK,CAACwC,GAAN,CAAU,OAAV,EACAC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GACD,CAHD,CAKA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtB,GAAIC,CAAAA,CAAJ,CACA,GAAI,CAACxB,YAAL,CAAmB,CAClB,CADD,IACO,CACLrB,KAAK,CACF8C,IADH,CACQ,mBADR,CAC6B,CACzBzB,YAAY,CAAEA,YADW,CAD7B,EAIG0B,IAJH,CAIQ,SAACC,QAAD,CAAc,CAClB,GAAIA,QAAQ,CAACC,IAAT,CAAc1B,WAAlB,CAA+B,CAC7B,IAAKsB,CAAC,CAAG,CAAT,CAAYA,CAAC,WAAMtB,WAAW,CAAC2B,MAAlB,CAAb,CAAyCL,CAAC,EAA1C,CAA8C,CAAG,CACjDrB,cAAc,8BACTD,WADS,GAEZ,CACEM,EAAE,CAAEgB,CADN,CAEEM,YAAY,CAAEH,QAAQ,CAACC,IAAT,CAAc1B,WAAd,CAA0B,CAA1B,EAA6B4B,YAF7C,CAGE9B,YAAY,CAAE2B,QAAQ,CAACC,IAAT,CAAc1B,WAAd,CAA0B,CAA1B,EAA6BF,YAH7C,CAIE+B,KAAK,CAAEJ,QAAQ,CAACC,IAAT,CAAc1B,WAAd,CAA0B,CAA1B,EAA6B6B,KAJtC,CAFY,GAAd,CASAxB,cAAc,CAACD,WAAW,CAAGqB,QAAQ,CAACC,IAAT,CAAc1B,WAAd,CAA0B,CAA1B,EAA6B6B,KAA5C,CAAd,CACD,CAZD,IAYO,IAAIJ,QAAQ,CAACC,IAAT,CAAcI,OAAlB,CAA2B,CAChC,IAAKR,CAAC,CAAG,CAAT,CAAYA,CAAC,WAAMtB,WAAW,CAAC2B,MAAlB,CAAb,CAAyCL,CAAC,EAA1C,CAA8C,CAAG,CACjDrB,cAAc,8BACTD,WADS,GAEZ,CACEM,EAAE,CAAEgB,CADN,CAEEM,YAAY,CAAEH,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBH,YAFzC,CAGE9B,YAAY,CAAE2B,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBjC,YAHzC,CAIE+B,KAAK,CAAEJ,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBF,KAJlC,CAFY,GAAd,CASA1B,gBAAgB,8BACXD,aADW,GAEd,CACEI,EAAE,CAAEgB,CADN,CAEEM,YAAY,CAAEH,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBH,YAFzC,CAGE9B,YAAY,CAAE2B,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBjC,YAHzC,CAIE+B,KAAK,CAAEJ,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBF,KAJlC,CAKEG,YAAY,CAAEP,QAAQ,CAACC,IAAT,CAAcI,OAAd,CAAsBE,YALtC,CAFc,GAAhB,CAUA3B,cAAc,CAACD,WAAW,CAAGqB,QAAQ,CAACC,IAAT,CAAcK,OAAd,CAAsB,CAAtB,EAAyBF,KAAxC,CAAd,CACD,CACF,CAxCH,EAyCA9B,eAAe,CAAC,EAAD,CAAf,CACD,CACF,CA/CD,CAiDA,GAAMkC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CAC/B,GAAI,CAACrB,SAAL,CAAgB,CACdnC,KAAK,CAAC8C,IAAN,CAAW,qBAAX,CAAkC,CAChCW,IAAI,CAAElC,WAD0B,CAEhCY,SAAS,CAAEA,SAFqB,CAAlC,EAIAuB,KAAK,CAAC,SAAD,CAAL,CACAtC,OAAO,CAACuC,EAAR,GACD,CAPD,IAOO,CACL,GAAI5B,SAAS,CAAGM,WAAhB,CAA6B,CAC3BqB,KAAK,CAAC,uCAAD,CAAL,CACD,CAFD,IAEO,CACL1D,KAAK,CACF8C,IADH,CACQ,iBADR,CAC2B,CACvBT,WAAW,CAAEA,WADU,CAEvBF,SAAS,CAAEA,SAFY,CAD3B,EAKGY,IALH,CAKQ,SAACC,QAAD,CAAc,CAClB,GAAIA,QAAQ,CAACC,IAAT,CAAcW,SAAlB,CAA6B,CAC3B5D,KAAK,CAAC8C,IAAN,CAAW,qBAAX,CAAkC,CAChCW,IAAI,CAAElC,WAD0B,CAEhCY,SAAS,CAAEA,SAFqB,CAAlC,EAIAuB,KAAK,CAACV,QAAQ,CAACC,IAAT,CAAcW,SAAf,CAAL,CACA5D,KAAK,CAACwC,GAAN,CAAU,OAAV,EACApB,OAAO,CAACyC,IAAR,CAAa,uBAAb,EACD,CARD,IAQO,CACLH,KAAK,CAACV,QAAQ,CAACC,IAAT,CAAca,OAAf,CAAL,CACD,CACF,CAjBH,EAkBD,CACF,CACF,CAhCD,CAkCA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAC3B,GAAIC,CAAAA,cAAc,CAAG,CAArB,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,WAAMxC,aAAa,CAACyB,MAApB,CAAjB,CAA+Ce,CAAC,EAAhD,CAAoD,CAClDD,cAAc,EACZvC,aAAa,CAACwC,CAAD,CAAb,CAAiBV,YAAjB,CAAgCW,IAAI,CAACC,KAAL,CAAW1C,aAAa,CAACwC,CAAD,CAAb,CAAiBb,KAAjB,CAAyB,EAApC,CADlC,CAED,CACDd,cAAc,CAAC4B,IAAI,CAACC,KAAL,CAAWxC,WAAW,CAAG,EAAzB,EAA+BqC,cAAhC,CAAd,CACA,GAAIzC,WAAW,CAAC2B,MAAZ,GAAuB,CAA3B,CAA8B,CAC7B,CADD,IACO,CACLjC,SAAS,GACV,CACF,CAXD,CAaA,GAAMmD,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,CAAD,CAAO,CAC3B,GAAMxC,CAAAA,EAAE,CAAGwC,CAAC,CAACC,MAAF,CAASC,YAAT,CAAsB,MAAtB,CAAX,CACA/C,cAAc,CACZD,WAAW,CAACiD,MAAZ,CAAmB,SAACjD,WAAD,QAAiBkD,CAAAA,IAAI,CAACC,SAAL,CAAenD,WAAW,CAACM,EAA3B,IAAmCA,EAApD,EAAnB,CADY,CAAd,CAGAH,gBAAgB,CACdD,aAAa,CAAC+C,MAAd,CACE,SAAC/C,aAAD,QAAmBgD,CAAAA,IAAI,CAACC,SAAL,CAAejD,aAAa,CAACI,EAA7B,IAAqCA,EAAxD,EADF,CADc,CAAhB,CAKD,CAVD,CAYA,GAAM8C,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACvB,KAAD,CAAW,CAC7BxB,cAAc,CAACD,WAAW,CAAGyB,KAAf,CAAd,CACD,CAFD,CAIA,GAAMwB,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1BxD,OAAO,CAACyC,IAAR,CAAa,oBAAb,EACD,CAFD,CAIA,wCAEA,GAAMgB,CAAAA,cAAc,CAAG,CACrBC,EAAE,CAAE,CACFC,OAAO,CAAE,CADP,CAEFC,CAAC,CAAE,CAFD,CADiB,CAKrBC,GAAG,CAAE,CACHF,OAAO,CAAE,CADN,CAEHC,CAAC,CAAE,GAFA,CALgB,CAAvB,CAWA,wCAEAjF,SAAS,CAAC,UAAM,CACdC,KAAK,CAACwC,GAAN,CAAU,QAAV,EAAoBO,IAApB,CAAyB,SAACC,QAAD,CAAc,CACrC,GAAIA,QAAQ,CAACC,IAAT,CAAciC,QAAd,GAA2B,IAA/B,CAAqC,CACnCpD,KAAK,CAACkB,QAAQ,CAACC,IAAT,CAAckC,IAAd,CAAmB,CAAnB,EAAsBtD,EAAvB,CAAL,CACAG,YAAY,CAACgB,QAAQ,CAACC,IAAT,CAAckC,IAAd,CAAmB,CAAnB,EAAsBpD,SAAvB,CAAZ,CACAG,QAAQ,CAACc,QAAQ,CAACC,IAAT,CAAckC,IAAd,CAAmB,CAAnB,EAAsBlD,KAAvB,CAAR,CACD,CACD,GACEe,QAAQ,CAACC,IAAT,CAAciC,QAAd,GAA2B,KAA3B,EACAlC,QAAQ,CAACC,IAAT,CAAckC,IAAd,CAAmB,CAAnB,EAAsBC,IAAtB,GAA+B,MAFjC,CAGE,CACA,MAAOhE,CAAAA,OAAO,CAACyC,IAAR,CAAa,QAAb,CAAP,CACD,CACF,CAZD,EAaD,CAdQ,CAcN,EAdM,CAAT,CAgBA,mBACE,aAAK,SAAS,CAAC,oBAAf,wBACE,YAAK,SAAS,CAAC,iBAAf,uBACE,KAAC,KAAD,EACE,MAAM,CAAE9C,WADV,CAEE,WAAW,CAAEG,cAFf,CAGE,cAAc,CAAEC,UAHlB,CAIE,KAAK,CAAEf,YAJT,CAKE,YAAY,CAAC,eALf,uBAOE,KAAC,MAAD,CAAQ,GAAR,EAAY,OAAO,CAAE,CAAE2E,OAAO,CAAE,CAAX,CAAcM,CAAC,CAAE,GAAjB,CAArB,CAA6C,OAAO,CAAE,CAAEN,OAAO,CAAE,CAAX,CAAcM,CAAC,CAAE,CAAjB,CAAtD,CAA4E,IAAI,CAAE,CAAEN,OAAO,CAAE,CAAX,CAAcM,CAAC,CAAE,GAAjB,CAAlF,uBACE,aAAK,SAAS,CAAC,oBAAf,wBACE,YAAI,SAAS,CAAC,kBAAd,qDAA2ChD,WAA3C,qCADF,cAEE,oCACE,eACE,SAAS,CAAC,wBADZ,CAEE,OAAO,CAAEmB,kBAFX,kDADF,cAOE,eAAQ,SAAS,CAAC,wBAAlB,CAA2C,OAAO,CAAErC,UAApD,kDAPF,GAFF,GADF,EAPF,EADF,EADF,cA2BE,aACE,GAAG,CAAC,YADN,CAEE,IAAI,CAAC,UAFP,CAGE,IAAI,CAAC,uEAHP,EA3BF,cAgCE,aACE,IAAI,CAAC,uEADP,CAEE,GAAG,CAAC,YAFN,EAhCF,cAqCE,aAAK,SAAS,CAAC,sDAAf,wBACE,KAAC,IAAD,EAAM,SAAS,CAAC,aAAhB,CAA8B,EAAE,CAAC,GAAjC,uBACE,UAAG,SAAS,CAAC,mBAAb,uBACE,UAAG,SAAS,CAAC,IAAb,8DADF,EADF,EADF,cAME,YAAK,SAAS,CAAC,eAAf,uBACE,YAAK,SAAS,CAAC,WAAf,CAA2B,GAAG,CAAC,kBAA/B,EADF,EANF,GArCF,cAgDE,MAAC,MAAD,CAAQ,GAAR,EACE,OAAO,CAAC,KADV,CAEE,OAAO,CAAC,IAFV,CAGE,IAAI,CAAC,KAHP,CAIE,QAAQ,CAAE0D,cAJZ,wBAME,aAAK,SAAS,CAAC,sBAAf,wBACE,gBAAQ,OAAO,CAAED,aAAjB,CAAgC,SAAS,CAAC,cAA1C,wBACE,UAAG,SAAS,CAAC,aAAb,EADF,4DADF,cAME,aAAK,SAAS,CAAC,eAAf,wBACE,WAAI,SAAS,CAAC,aAAd,0EADF,cAEE,YAAI,SAAS,CAAC,aAAd,2GACqB7C,SADrB,CACgC,GADhC,cAEE,UACE,OAAO,CAAEQ,OADX,CAEE,SAAS,CAAC,iBAFZ,CAGE,KAAK,CAAE,CAAE+C,KAAK,CAAE,OAAT,CAHT,EAFF,GAFF,GANF,cAkBE,cACE,SAAS,CAAC,yBADZ,CAEE,QAAQ,CAAE,kBAACjB,CAAD,CAAO,CACfA,CAAC,CAACkB,cAAF,GACA3C,SAAS,GACV,CALH,wBAOE,cACE,SAAS,CAAC,kCADZ,CAEE,IAAI,CAAC,KAFP,CAGE,WAAW,CAAC,sFAHd,CAIE,QAAQ,CAAE,kBAACyB,CAAD,CAAO,CACfjC,YAAY,CAACiC,CAAC,CAACC,MAAF,CAASkB,KAAV,CAAZ,CACD,CANH,EAPF,cAeE,cACE,SAAS,CAAC,kCADZ,CAEE,IAAI,CAAC,MAFP,CAGE,WAAW,CAAC,8DAHd,CAIE,KAAK,CAAEnE,YAJT,CAKE,QAAQ,CAAE,kBAACgD,CAAD,CAAO,CACf/C,eAAe,CAAC+C,CAAC,CAACC,MAAF,CAASkB,KAAV,CAAf,CACD,CAPH,EAfF,cAyBE,eAAQ,SAAS,CAAC,iCAAlB,CAAoD,IAAI,CAAC,QAAzD,sCAzBF,GAlBF,GANF,cAuDE,YAAK,KAAK,CAAC,4CAAX,uBACE,eAAO,KAAK,CAAC,yCAAb,wBACE,oCACE,mCACE,WAAI,SAAS,CAAC,UAAd,CAAyB,KAAK,CAAC,KAA/B,sFADF,cAIE,WAAI,SAAS,CAAC,UAAd,CAAyB,KAAK,CAAC,KAA/B,sCAJF,cAOE,WAAI,SAAS,CAAC,UAAd,CAAyB,KAAK,CAAC,KAA/B,8DAPF,GADF,EADF,CAcGjE,WAAW,CAACkE,GAAZ,CAAgB,SAAC3C,IAAD,CAAU,CACzB,mBACE,oCACE,mCACE,WAAI,SAAS,CAAC,UAAd,uBACE,mBAAIA,IAAI,CAACK,YAAT,EADF,EADF,cAIE,WAAI,SAAS,CAAC,UAAd,uBACE,UAAG,KAAK,CAAEL,IAAI,CAACM,KAAf,UAAuBN,IAAI,CAACM,KAA5B,EADF,EAJF,cAOE,WAAI,SAAS,CAAC,UAAd,uBACE,gBACE,SAAS,CAAC,oBADZ,CAEE,IAAI,CAAEN,IAAI,CAACjB,EAFb,CAGE,OAAO,CAAE,iBAACwC,CAAD,CAAO,CACdD,aAAa,CAACC,CAAD,CAAb,CACAM,WAAW,CAAC7B,IAAI,CAACM,KAAN,CAAX,CACD,CANH,wBAQE,UAAG,SAAS,CAAC,qBAAb,EARF,uEAQsD,GARtD,cASE,UAAG,SAAS,CAAC,qBAAb,EATF,GADF,EAPF,GADF,EADF,CAyBD,CA1BA,CAdH,cAyCE,oBACG3B,aAAa,CAACgE,GAAd,CAAkB,SAACC,SAAD,CAAe,CAChC,mBACE,YAAK,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAX,CAAZ,uBACE,WAAG,IAAI,CAAED,SAAS,CAAC7D,EAAnB,qGACoB6D,SAAS,CAACvC,YAD9B,GADF,EADF,CAOD,CARA,CADH,EAzCF,GADF,EAvDF,cA8GE,aAAK,SAAS,CAAC,iBAAf,wBACE,YAAI,SAAS,CAAC,gBAAd,2DAA0CxB,WAA1C,OADF,cAEE,eAAQ,SAAS,CAAC,oBAAlB,CAAuC,OAAO,CAAEoC,cAAhD,wDAFF,GA9GF,GAhDF,GADF,CAwKD,CACD,cAAejD,CAAAA,kBAAf","sourcesContent":["import React, { useState } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport { useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport Modal from \"react-modal\";\r\nimport \"./Calculatepointshop.css\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\n\r\nconst customStyles = {\r\n  content: {\r\n    width: \"100%\",\r\n    height: \"50%\",\r\n    top: \"50%\",\r\n    left: \"50%\",\r\n    right: \"auto\",\r\n    bottom: \"auto\",\r\n    marginRight: \"-50%\",\r\n    transform: \"translate(-50%, -50%)\",\r\n  },\r\n};\r\n\r\nfunction Calculatepointshop() {\r\n  const [modalIsOpen, setIsOpen] = React.useState(false);\r\n\r\n  function openModal() {\r\n    setIsOpen(true);\r\n  }\r\n\r\n  function afterOpenModal() {\r\n    // references are now sync'd and can be accessed.\r\n  }\r\n\r\n  function closeModal() {\r\n    setIsOpen(false);\r\n  }\r\n\r\n  //-----------------------------------------------------\r\n  const history = useHistory();\r\n  //-----------------------------------------------------\r\n  const [product_code, setproduct_code] = useState(\"\");\r\n  const [productlist, setProductlist] = useState([]);\r\n  const [promotionlist, setPromotionlist] = useState([]);\r\n  const [total_price, setTotal_Price] = useState(0);\r\n  const [id, setId] = useState();\r\n  const [shoppoint, setShopPoint] = useState();\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [destPhone, setdestPhone] = useState(\"\");\r\n  const [total_point, setTotal_Point] = useState(0);\r\n\r\n  const refresh = () => {\r\n    axios.get(\"/shop\");\r\n    window.location.reload();\r\n  };\r\n\r\n  const entercode = () => {\r\n    var a;\r\n    if (!product_code) {\r\n    } else {\r\n      axios\r\n        .post(\"/enterproductcode\", {\r\n          product_code: product_code,\r\n        })\r\n        .then((response) => {\r\n          if (response.data.productlist) {\r\n            for (a = 0; a < `${productlist.length}`; a++) { }\r\n            setProductlist([\r\n              ...productlist,\r\n              {\r\n                id: a,\r\n                product_name: response.data.productlist[0].product_name,\r\n                product_code: response.data.productlist[0].product_code,\r\n                price: response.data.productlist[0].price,\r\n              },\r\n            ]);\r\n            setTotal_Price(total_price + response.data.productlist[0].price);\r\n          } else if (response.data.result2) {\r\n            for (a = 0; a < `${productlist.length}`; a++) { }\r\n            setProductlist([\r\n              ...productlist,\r\n              {\r\n                id: a,\r\n                product_name: response.data.result1[0].product_name,\r\n                product_code: response.data.result1[0].product_code,\r\n                price: response.data.result1[0].price,\r\n              },\r\n            ]);\r\n            setPromotionlist([\r\n              ...promotionlist,\r\n              {\r\n                id: a,\r\n                product_name: response.data.result1[0].product_name,\r\n                product_code: response.data.result1[0].product_code,\r\n                price: response.data.result1[0].price,\r\n                amount_point: response.data.result2.amount_point,\r\n              },\r\n            ]);\r\n            setTotal_Price(total_price + response.data.result1[0].price);\r\n          }\r\n        });\r\n      setproduct_code(\"\");\r\n    }\r\n  };\r\n\r\n  const transferTocustomer = () => {\r\n    if (!destPhone) {\r\n      axios.post(\"/transaction/buying\", {\r\n        list: productlist,\r\n        destPhone: destPhone,\r\n      });\r\n      alert(\"success\");\r\n      history.go();\r\n    } else {\r\n      if (shoppoint < total_point) {\r\n        alert(\"คะแนนร้านค้าไม่เพียงพอ กรุณาเติมคะแนน\");\r\n      } else {\r\n        axios\r\n          .post(\"/calculateprice\", {\r\n            total_point: total_point,\r\n            destPhone: destPhone,\r\n          })\r\n          .then((response) => {\r\n            if (response.data.calculate) {\r\n              axios.post(\"/transaction/buying\", {\r\n                list: productlist,\r\n                destPhone: destPhone,\r\n              });\r\n              alert(response.data.calculate);\r\n              axios.get(\"/shop\");\r\n              history.push(\"/calculate-point-shop\");\r\n            } else {\r\n              alert(response.data.message);\r\n            }\r\n          });\r\n      }\r\n    }\r\n  };\r\n\r\n  const calculatepoint = () => {\r\n    var promotionpoint = 0;\r\n    for (let i = 0; i < `${promotionlist.length}`; i++) {\r\n      promotionpoint +=\r\n        promotionlist[i].amount_point - Math.floor(promotionlist[i].price / 50);\r\n    }\r\n    setTotal_Point(Math.floor(total_price / 50) + promotionpoint);\r\n    if (productlist.length === 0) {\r\n    } else {\r\n      openModal();\r\n    }\r\n  };\r\n\r\n  const deleteproduct = (e) => {\r\n    const id = e.target.getAttribute(\"name\");\r\n    setProductlist(\r\n      productlist.filter((productlist) => JSON.stringify(productlist.id) !== id)\r\n    );\r\n    setPromotionlist(\r\n      promotionlist.filter(\r\n        (promotionlist) => JSON.stringify(promotionlist.id) !== id\r\n      )\r\n    );\r\n  };\r\n\r\n  const updateprice = (price) => {\r\n    setTotal_Price(total_price - price);\r\n  };\r\n\r\n  const gotoTopupPage = () => {\r\n    history.push(\"/top-up-point-shop\");\r\n  };\r\n\r\n  /* ********************************** */\r\n\r\n  const pageTransition = {\r\n    in: {\r\n      opacity: 1,\r\n      x: 0,\r\n    },\r\n    out: {\r\n      opacity: 0,\r\n      x: 100,\r\n    },\r\n  };\r\n\r\n  /* ********************************** */\r\n\r\n  useEffect(() => {\r\n    axios.get(\"/login\").then((response) => {\r\n      if (response.data.loggedIn === true) {\r\n        setId(response.data.user[0].id);\r\n        setShopPoint(response.data.user[0].shoppoint);\r\n        setPhone(response.data.user[0].phone);\r\n      }\r\n      if (\r\n        response.data.loggedIn === false ||\r\n        response.data.user[0].role !== \"shop\"\r\n      ) {\r\n        return history.push(\"/login\");\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"calculatepointpage\">\r\n      <div className=\"calculate-modal\">\r\n        <Modal\r\n          isOpen={modalIsOpen}\r\n          onAfterOpen={afterOpenModal}\r\n          onRequestClose={closeModal}\r\n          style={customStyles}\r\n          contentLabel=\"Example Modal\"\r\n        >\r\n          <motion.div initial={{ opacity: 0, y: 100 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 100 }}>\r\n            <div className=\"divcalculate-modal\">\r\n              <h2 className=\"pcalculate-modal\">ได้รับ : {total_point} คะแนน</h2>\r\n              <div>\r\n                <button\r\n                  className=\"buttoncalculate-modal1\"\r\n                  onClick={transferTocustomer}\r\n                >\r\n                  ยืนยัน\r\n                </button>\r\n                <button className=\"buttoncalculate-modal2\" onClick={closeModal}>\r\n                  ยกเลิก\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </Modal>\r\n      </div>\r\n      <link\r\n        rel=\"stylesheet\"\r\n        type=\"text/css\"\r\n        href=\"//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css\"\r\n      />\r\n      <link\r\n        href=\"//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css\"\r\n        rel=\"stylesheet\"\r\n      ></link>\r\n\r\n      <nav className=\"navbar navbar-light bg-light justify-content-between\">\r\n        <Link className=\"buttonblack\" to=\"/\">\r\n          <i className=\"fas fa-angle-left\">\r\n            <a className=\"bl\">ย้อนกลับ</a>\r\n          </i>\r\n        </Link>\r\n        <div className=\"div-img-logo2\">\r\n          <img className=\"img-logoo\" src=\"/images/logo.png\" />\r\n        </div>\r\n      </nav>\r\n\r\n      <motion.div\r\n        initial=\"out\"\r\n        animate=\"in\"\r\n        exit=\"out\"\r\n        variants={pageTransition}\r\n      >\r\n        <div className=\"calculate-point-shop\">\r\n          <button onClick={gotoTopupPage} className=\"buttontop-up\">\r\n            <i className=\"fas fa-plus\"></i>\r\n            เติมคะแนน\r\n          </button>\r\n\r\n          <div className=\"calculate-con\">\r\n            <h2 className=\"h2promotion\">คำนวณคะแนน</h2>\r\n            <h1 className=\"h1promotion\">\r\n              คะแนนของร้านค้า : {shoppoint}{\" \"}\r\n              <i\r\n                onClick={refresh}\r\n                className=\"fas fa-sync-alt\"\r\n                style={{ color: \"black\" }}\r\n              />\r\n            </h1>\r\n          </div>\r\n\r\n          <form\r\n            className=\"from-calculatepointshop\"\r\n            onSubmit={(e) => {\r\n              e.preventDefault();\r\n              entercode();\r\n            }}\r\n          >\r\n            <input\r\n              className=\"input-input1-calculatepointshopp\"\r\n              type=\"tel\"\r\n              placeholder=\"เบอร์โทรลูกค้า\"\r\n              onChange={(e) => {\r\n                setdestPhone(e.target.value);\r\n              }}\r\n            />\r\n            <input\r\n              className=\"input-input2-calculatepointshopp\"\r\n              type=\"text\"\r\n              placeholder=\"รหัสสินค้า\"\r\n              value={product_code}\r\n              onChange={(e) => {\r\n                setproduct_code(e.target.value);\r\n              }}\r\n            />\r\n\r\n            <button className=\"button-input-calculatepointshop\" type=\"submit\">\r\n              ตกลง\r\n            </button>\r\n          </form>\r\n        </div>\r\n\r\n        <div class=\"table-wrapper-scroll-y my-custom-scrollbar\">\r\n          <table class=\"table table-bordered table-striped mb-0\">\r\n            <thead>\r\n              <tr>\r\n                <th className=\"th-table\" scope=\"col\">\r\n                  รายการสินค้า\r\n                </th>\r\n                <th className=\"th-table\" scope=\"col\">\r\n                  ราคา\r\n                </th>\r\n                <th className=\"th-table\" scope=\"col\">\r\n                  ตัวเลือก\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            {productlist.map((post) => {\r\n              return (\r\n                <tbody>\r\n                  <tr>\r\n                    <td className=\"td-table\">\r\n                      <p>{post.product_name}</p>\r\n                    </td>\r\n                    <td className=\"td-table\">\r\n                      <p price={post.price}>{post.price}</p>\r\n                    </td>\r\n                    <td className=\"td-table\">\r\n                      <button\r\n                        className=\"button-delete-item\"\r\n                        name={post.id}\r\n                        onClick={(e) => {\r\n                          deleteproduct(e);\r\n                          updateprice(post.price);\r\n                        }}\r\n                      >\r\n                        <i className=\"far fa-times-circle\"></i> ลบรายการนี้{\" \"}\r\n                        <i className=\"far fa-times-circle\"></i>\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              );\r\n            })}\r\n            <tr>\r\n              {promotionlist.map((promotion) => {\r\n                return (\r\n                  <div style={{ display: \"flex\" }}>\r\n                    <p name={promotion.id}>\r\n                      สินค้าโปรโมชัน : {promotion.product_name}\r\n                    </p>\r\n                  </div>\r\n                );\r\n              })}\r\n            </tr>\r\n          </table>\r\n        </div>\r\n        <div className=\"div-total-price\">\r\n          <h3 className=\"h3-total-price\">ราคารวม : {total_price} </h3>\r\n          <button className=\"button-total-price\" onClick={calculatepoint}>\r\n            คิดเงิน\r\n          </button>\r\n        </div>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\nexport default Calculatepointshop;\r\n"]},"metadata":{},"sourceType":"module"}